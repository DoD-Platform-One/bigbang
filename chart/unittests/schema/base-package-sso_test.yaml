# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Schema Validation - Base Package SSO
tests:
  - it: should pass validation with valid SSO configuration
    set:
      tempo:
        sso:
          enabled: true
          client_id: "id"
          client_secret: "1234"
      neuvector:
        sso:
          enabled: true
          client_id: "id"
          client_secret: "string"
    asserts:
      - notFailedTemplate: {}

  - it: should pass validation with extended SSO configuration (neuvector)
    set:
      sso:
        enabled: true
        client_id: client
        client_secret: secret
        default_role: admin
        issuer: https://login.dso.mil/auth/realms/baby-yoda
        group_claim: roles
        group_mapped_roles:
          - group: admin
            global_role: admin
          - group: reader
            global_role: reader
    asserts:
      - notFailedTemplate: {}

  - it: should fail validation with extra key in neuvector SSO
    set:
      tempo:
        sso:
          enabled: true
          client_id: "id"
          client_secret: "1234"
      neuvector:
        sso:
          enabled: true
          client_id: "id"
          client_secret: "string"
          extra: "key"
    asserts:
      - failedTemplate:
          errorPattern: ".*"

  - it: should fail validation with extra key in monitoring SSO
    set:
      monitoring:
        sso:
          extra: key
    asserts:
      - failedTemplate:
          errorPattern: ".*"

  - it: should fail validation with extra key in twistlock SSO
    set:
      twistlock:
        sso:
          enabled: true
          client_id: "id"
          provider_type: "string"
          extra: "key"
    asserts:
      - failedTemplate:
          errorPattern: ".*"
