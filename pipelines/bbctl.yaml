workflow:
  rules:
    # run pipeline for manual tag events
    - if: $CI_COMMIT_TAG
    # run pipeline on merge request events
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    # run pipeline on commits to default branch
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

variables:
  REPO_NAME: repo1.dso.mil/platform-one/big-bang/apps/product-tools/bbctl

before_script:
  - mkdir -p $GOPATH/src/$(dirname $REPO_NAME)
  - ln -svf $CI_PROJECT_DIR $GOPATH/src/$REPO_NAME
  - cd $GOPATH/src/$REPO_NAME

stages:
  - test

go-lint:
  stage: test
  image: registry.gitlab.com/pipeline-components/go-lint:0.14.0
  script:
    - golint -set_exit_status ./...

go-test:
  stage: test
  image: golang:1.17
  script:
    - go get gotest.tools/gotestsum
    - gotestsum --format testname -- -coverprofile=cover.out ./...
